<!doctype HTML>
<html>
  <head>
    <title>lunar rocks</title>
    <meta charset="utf-8" />
    <link href="https://fonts.googleapis.com/css?family=Cinzel|Quattrocento+Sans" rel="stylesheet">
  </head>
  <body>
    <div id="main"></div>
    <script type="text/javascript" src="main.js"></script>


    <script src='https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js'></script>
    <!-- celesta -->
    <!-- <script src='https://surikov.github.io/webaudiofontdata/sound/0080_FluidR3_GM_sf2_file.js'></script> -->
    <!-- xylophone -->
    <script src='https://surikov.github.io/webaudiofontdata/sound/0130_FluidR3_GM_sf2_file.js'></script>
    <!-- marimba -->
    <script src='https://surikov.github.io/webaudiofontdata/sound/0120_FluidR3_GM_sf2_file.js'></script>
    <!-- vibraphone -->
    <!-- <script src='https://surikov.github.io/webaudiofontdata/sound/0110_FluidR3_GM_sf2_file.js'></script> -->
    <!-- charang -->
    <!-- <script src='https://surikov.github.io/webaudiofontdata/sound/0842_FluidR3_GM_sf2_file.js'></script> -->
    <!-- synth bass 2 -->
    <!-- <script src='https://surikov.github.io/webaudiofontdata/sound/0390_FluidR3_GM_sf2_file.js'></script> -->
    <script>
     "use strict"
     var app = Elm.Main.fullscreen();

     var AudioContextFunc = window.AudioContext || window.webkitAudioContext;
		 var audioContext = new AudioContextFunc();
     var player=new WebAudioFontPlayer();


     /* xylophone */
     player.loader.decodeAfterLoading(audioContext, '_tone_0130_FluidR3_GM_sf2_file');
     /* celesta*/
     /* player.loader.decodeAfterLoading(audioContext, '_tone_0080_FluidR3_GM_sf2_file');*/
     /* marimba*/
     player.loader.decodeAfterLoading(audioContext, '_tone_0120_FluidR3_GM_sf2_file');
     /* vibraphone*/
     /* player.loader.decodeAfterLoading(audioContext, '_tone_0110_FluidR3_GM_sf2_file');*/
     /* Lead 5: Charang*/
     /* player.loader.decodeAfterLoading(audioContext, '_tone_0842_FluidR3_GM_sf2_file');*/
     /* Synth Bass 2*/
     /* player.loader.decodeAfterLoading(audioContext, '_tone_0390_FluidR3_GM_sf2_file');*/

     var compressor = audioContext.createDynamicsCompressor();
     compressor.threshold.value = -30;
     compressor.knee.value = 40;
     compressor.ratio.value = 12;
     compressor.attack.value = 0.15;
     compressor.release.value = 0.25;
     compressor.connect(audioContext.destination);

     var highpassFilter = audioContext.createBiquadFilter();
     highpassFilter.type = 'highpass';
     highpassFilter.frequency.value = 50;
     highpassFilter.connect(compressor);

     var lowpassFilter = audioContext.createBiquadFilter();
     lowpassFilter.type = 'lowpass';
     lowpassFilter.frequency.value = 8000;
     lowpassFilter.connect(highpassFilter);


     function playNote(trackId, tone){
       if (trackId === 0) {
         player.queueWaveTable(audioContext, lowpassFilter
                             , _tone_0130_FluidR3_GM_sf2_file , 0, (12*6+tone), 1, 0.4);
       }
       else {
         player.queueWaveTable(audioContext, lowpassFilter
                             , _tone_0120_FluidR3_GM_sf2_file , 0, (12*4+tone), 1, 0.3);
       }
	     return false;
     }

     app.ports.play.subscribe(function (args) {
       // args.beat and args.duration also available
       playNote(args.trackId, args.tone);
     });
    </script>

  </body>

</html>
